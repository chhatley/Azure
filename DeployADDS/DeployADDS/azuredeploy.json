{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "_artifactsLocation": {
      "type": "https://github.com/chhatley/Azure/tree/master/DeployADDS/DeployADDS"
    },
    "_artifactsLocationSasToken": {
      "type": "securestring"
    },
    "Deploy-ADDS-DC-01-NICName": {
      "type": "string",
      "minLength": 1
    },
    "Deploy-ADDS-DC-02-NICName": {
      "type": "string",
      "minLength": 1
    },
    "Deploy-ADDS-DC-02-NICSkuName": {
      "type": "string",
      "defaultValue": "F1",
      "allowedValues": [
        "F1",
        "D1",
        "B1",
        "B2",
        "B3",
        "S1",
        "S2",
        "S3",
        "P1",
        "P2",
        "P3",
        "P4"
      ],
      "metadata": {
        "description": "Describes plan's pricing tier and capacity. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/"
      }
    },
    "Deploy-T0-DC-01Name": {
      "type": "string",
      "minLength": 1
    },
    "Deploy-T0-DC-01SkuName": {
      "type": "string",
      "defaultValue": "F1",
      "allowedValues": [
        "F1",
        "D1",
        "B1",
        "B2",
        "B3",
        "S1",
        "S2",
        "S3",
        "P1",
        "P2",
        "P3",
        "P4"
      ],
      "metadata": {
        "description": "Describes plan's pricing tier and capacity. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/"
      }
    },
    "Deploy-T0-ASG-DC-to-ClientName": {
      "type": "string",
      "minLength": 1
    },
    "Deploy-T0-ASG-DC-to-ClientSkuName": {
      "type": "string",
      "defaultValue": "F1",
      "allowedValues": [
        "F1",
        "D1",
        "B1",
        "B2",
        "B3",
        "S1",
        "S2",
        "S3",
        "P1",
        "P2",
        "P3",
        "P4"
      ],
      "metadata": {
        "description": "Describes plan's pricing tier and capacity. Check details at https://azure.microsoft.com/en-us/pricing/details/app-service/"
      }
    }},
  "variables": {
    "Deploy-GL-vNet-RGTemplateFolder": "nestedtemplates",
    "Deploy-GL-vNet-RGTemplateFileName": "Deploy-GL-vNet-RG.json",
    "Deploy-GL-vNet-RGTemplateParametersFileName": "Deploy-GL-vNet-RG.parameters.json",
    "Deploy-GL-vNET-01TemplateFolder": "nestedtemplates",
    "Deploy-GL-vNET-01TemplateFileName": "Deploy-GL-vNET-01.json",
    "Deploy-GL-vNET-01TemplateParametersFileName": "Deploy-GL-vNET-01.parameters.json",
    "Deploy-GL-AS-SN-01TemplateFolder": "nestedtemplates",
    "Deploy-GL-AS-SN-01TemplateFileName": "Deploy-GL-AS-SN-01.json",
    "Deploy-GL-AS-SN-01TemplateParametersFileName": "Deploy-GL-AS-SN-01.parameters.json",
    "Deploy-T0-ADDS-RGTemplateFolder": "nestedtemplates",
    "Deploy-T0-ADDS-RGTemplateFileName": "Deploy-T0-ADDS-RG.json",
    "Deploy-T0-ADDS-RGTemplateParametersFileName": "Deploy-T0-ADDS-RG.parameters.json",
    "Deploy-T0-ADDS-AvailabilitySetTemplateFolder": "nestedtemplates",
    "Deploy-T0-ADDS-AvailabilitySetTemplateFileName": "Deploy-T0-ADDS-AvailabilitySet.json",
    "Deploy-T0-ADDS-AvailabilitySetTemplateParametersFileName": "Deploy-T0-ADDS-AvailabilitySet.parameters.json",
    "Deploy-ADDS-DC-02-NICTemplateFolder": "nestedtemplates",
    "Deploy-ADDS-DC-02-NICTemplateFileName": "Deploy-ADDS-DC-02-NIC.json",
    "Deploy-ADDS-DC-02-NICTemplateParametersFileName": "Deploy-ADDS-DC-02-NIC.parameters.json",
    "Deploy-ADDS-JS-01-NICTemplateFolder": "nestedtemplates",
    "Deploy-ADDS-JS-01-NICTemplateFileName": "Deploy-ADDS-JS-01-NIC.json",
    "Deploy-ADDS-JS-01-NICTemplateParametersFileName": "Deploy-ADDS-JS-01-NIC.parameters.json",
    "Deploy-T0-NSG-RGTemplateFolder": "nestedtemplates",
    "Deploy-T0-NSG-RGTemplateFileName": "Deploy-T0-NSG-RG.json",
    "Deploy-T0-NSG-RGTemplateParametersFileName": "Deploy-T0-NSG-RG.parameters.json",
    "Deploy-T0-DC-02TemplateFolder": "nestedtemplates",
    "Deploy-T0-DC-02TemplateFileName": "Deploy-T0-DC-02.json",
    "Deploy-T0-DC-02TemplateParametersFileName": "Deploy-T0-DC-02.parameters.json",
    "Deploy-T0-JS-01TemplateFolder": "nestedtemplates",
    "Deploy-T0-JS-01TemplateFileName": "Deploy-T0-JS-01.json",
    "Deploy-T0-JS-01TemplateParametersFileName": "Deploy-T0-JS-01.parameters.json",
    "Deploy-JS-LoadBalancerTemplateFolder": "nestedtemplates",
    "Deploy-JS-LoadBalancerTemplateFileName": "Deploy-JS-LoadBalancer.json",
    "Deploy-JS-LoadBalancerTemplateParametersFileName": "Deploy-JS-LoadBalancer.parameters.json",
    "Deploy-T0-NSG-RG2TemplateFolder": "nestedtemplates",
    "Deploy-T0-NSG-RG2TemplateFileName": "Deploy-T0-NSG-RG2.json",
    "Deploy-T0-NSG-RG2TemplateParametersFileName": "Deploy-T0-NSG-RG2.parameters.json",
    "Deploy-T0-ASG-DC-to-JSTemplateFolder": "nestedtemplates",
    "Deploy-T0-ASG-DC-to-JSTemplateFileName": "Deploy-T0-ASG-DC-to-JS.json",
    "Deploy-T0-ASG-DC-to-JSTemplateParametersFileName": "Deploy-T0-ASG-DC-to-JS.parameters.json",
    "Deploy-T0-ASG-JS-to-Public-RDPTemplateFolder": "nestedtemplates",
    "Deploy-T0-ASG-JS-to-Public-RDPTemplateFileName": "Deploy-T0-ASG-JS-to-Public-RDP.json",
    "Deploy-T0-ASG-JS-to-Public-RDPTemplateParametersFileName": "Deploy-T0-ASG-JS-to-Public-RDP.parameters.json",
    "Deploy-T0-NSGTemplateFolder": "nestedtemplates",
    "Deploy-T0-NSGTemplateFileName": "Deploy-T0-NSG.json",
    "Deploy-T0-NSGTemplateParametersFileName": "Deploy-T0-NSG.parameters.json",
    "Deploy-NSG-RulesTemplateFolder": "nestedtemplates",
    "Deploy-NSG-RulesTemplateFileName": "Deploy-NSG-Rules.json",
    "Deploy-NSG-RulesTemplateParametersFileName": "Deploy-NSG-Rules.parameters.json"},
  "resources": [
    {
      "name": "Deploy-GL-vNet-RG",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-GL-vNet-RGTemplateFolder'), '/', variables('Deploy-GL-vNet-RGTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-GL-vNet-RGTemplateFolder'), '/', variables('Deploy-GL-vNet-RGTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-GL-vNET-01",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-GL-vNET-01TemplateFolder'), '/', variables('Deploy-GL-vNET-01TemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-GL-vNET-01TemplateFolder'), '/', variables('Deploy-GL-vNET-01TemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-GL-AS-SN-01",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-GL-AS-SN-01TemplateFolder'), '/', variables('Deploy-GL-AS-SN-01TemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-GL-AS-SN-01TemplateFolder'), '/', variables('Deploy-GL-AS-SN-01TemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-T0-ADDS-RG",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ADDS-RGTemplateFolder'), '/', variables('Deploy-T0-ADDS-RGTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ADDS-RGTemplateFolder'), '/', variables('Deploy-T0-ADDS-RGTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-T0-ADDS-AvailabilitySet",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ADDS-AvailabilitySetTemplateFolder'), '/', variables('Deploy-T0-ADDS-AvailabilitySetTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ADDS-AvailabilitySetTemplateFolder'), '/', variables('Deploy-T0-ADDS-AvailabilitySetTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "[parameters('Deploy-ADDS-DC-01-NICName')]",
      "type": "Microsoft.Resources/deployments",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-06-15",
      "dependsOn": [],
      "tags": {
        "displayName": "Deploy-ADDS-DC-01-NIC"
      },
      "properties": {
        "platformUpdateDomainCount": 1,
        "platformFaultDomainCount": 1
      }
    },
    {
      "name": "Deploy-ADDS-DC-02-NIC",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-ADDS-DC-02-NICTemplateFolder'), '/', variables('Deploy-ADDS-DC-02-NICTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-ADDS-DC-02-NICTemplateFolder'), '/', variables('Deploy-ADDS-DC-02-NICTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-ADDS-JS-01-NIC",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-ADDS-JS-01-NICTemplateFolder'), '/', variables('Deploy-ADDS-JS-01-NICTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-ADDS-JS-01-NICTemplateFolder'), '/', variables('Deploy-ADDS-JS-01-NICTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-T0-DC-02",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-DC-02TemplateFolder'), '/', variables('Deploy-T0-DC-02TemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-DC-02TemplateFolder'), '/', variables('Deploy-T0-DC-02TemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-T0-JS-01",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-JS-01TemplateFolder'), '/', variables('Deploy-T0-JS-01TemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-JS-01TemplateFolder'), '/', variables('Deploy-T0-JS-01TemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-JS-LoadBalancer",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-JS-LoadBalancerTemplateFolder'), '/', variables('Deploy-JS-LoadBalancerTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-JS-LoadBalancerTemplateFolder'), '/', variables('Deploy-JS-LoadBalancerTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-T0-NSG-RG",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-NSG-RG2TemplateFolder'), '/', variables('Deploy-T0-NSG-RG2TemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-NSG-RG2TemplateFolder'), '/', variables('Deploy-T0-NSG-RG2TemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "[parameters('Deploy-T0-ASG-DC-to-ClientName')]",
      "type": "Microsoft.Resources/deployments",
      "location": "[resourceGroup().location]",
      "apiVersion": "2015-08-01",
      "sku": {
        "name": "[parameters('Deploy-T0-ASG-DC-to-ClientSkuName')]"
      },
      "dependsOn": [ ],
      "tags": {
        "displayName": "Deploy-T0-ASG-DC-to-Client"
      },
      "properties": {
        "name": "[parameters('Deploy-T0-ASG-DC-to-ClientName')]",
        "numberOfWorkers": 1
      }
    },
    {
      "name": "Deploy-T0-ASG-DC-to-JS",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ASG-DC-to-JSTemplateFolder'), '/', variables('Deploy-T0-ASG-DC-to-JSTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ASG-DC-to-JSTemplateFolder'), '/', variables('Deploy-T0-ASG-DC-to-JSTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-T0-ASG-JS-to-Public-RDP",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ASG-JS-to-Public-RDPTemplateFolder'), '/', variables('Deploy-T0-ASG-JS-to-Public-RDPTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-ASG-JS-to-Public-RDPTemplateFolder'), '/', variables('Deploy-T0-ASG-JS-to-Public-RDPTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-T0-NSG",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-NSGTemplateFolder'), '/', variables('Deploy-T0-NSGTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-T0-NSGTemplateFolder'), '/', variables('Deploy-T0-NSGTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    },
    {
      "name": "Deploy-NSG-Rules",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2016-09-01",
      "dependsOn": [ ],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-NSG-RulesTemplateFolder'), '/', variables('Deploy-NSG-RulesTemplateFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        },
        "parametersLink": {
          "uri": "[concat(parameters('_artifactsLocation'), '/', variables('Deploy-NSG-RulesTemplateFolder'), '/', variables('Deploy-NSG-RulesTemplateParametersFileName'), parameters('_artifactsLocationSasToken'))]",
          "contentVersion": "1.0.0.0"
        }
      }
    }],
  "outputs": {}
}
